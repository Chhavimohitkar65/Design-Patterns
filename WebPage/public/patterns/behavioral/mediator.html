<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Mediator Pattern - Smart Home Demo</title>
    <style>
        :root {
            --primary: #3B82F6;
            --success: #10B981;
            --warning: #F59E0B;
            --danger: #EF4444;
            --text: #1F2937;
            --bg: #F3F4F6;
            --card: #FFFFFF;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            padding: 2rem;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .pattern-header {
            text-align: center;
            margin-bottom: 3rem;
            padding: 2rem;
            background: var(--card);
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .pattern-header h1 {
            color: var(--primary);
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .definition-card {
            background: linear-gradient(135deg, var(--primary), #6366F1);
            color: white;
            padding: 2rem;
            border-radius: 1rem;
            margin: 2rem 0;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .smart-home {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }

        .device-card {
            background: var(--card);
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .device-card:hover {
            transform: translateY(-5px);
        }

        .device-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .device-status {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .status-on {
            background: var(--success);
            color: white;
        }

        .status-off {
            background: var(--danger);
            color: white;
        }

        .device-controls {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .btn {
            padding: 0.75rem 1rem;
            border: none;
            border-radius: 0.5rem;
            background: var(--primary);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .btn:hover {
            filter: brightness(110%);
        }

        .btn:disabled {
            background: #CBD5E1;
            cursor: not-allowed;
        }

        .event-log {
            background: #1E293B;
            color: #E2E8F0;
            padding: 1.5rem;
            border-radius: 1rem;
            margin: 2rem 0;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
        }

        .log-entry {
            margin: 0.5rem 0;
            padding: 0.5rem;
            border-radius: 0.25rem;
            background: rgba(255, 255, 255, 0.1);
        }

        .diagram {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            margin: 2rem 0;
            text-align: center;
        }

        .component-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .component-card {
            background: white;
            padding: 1.5rem;
            border-radius: 0.5rem;
            border-left: 4px solid var(--primary);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="pattern-header">
            <h1>Mediator Design Pattern</h1>
            <p>A behavioral design pattern that reduces coupling between components by making them communicate indirectly through a mediator object.</p>
        </div>

        <div class="definition-card">
            <h2>Definition & Purpose</h2>
            <p>The Mediator pattern promotes loose coupling by keeping objects from referring to each other explicitly, allowing you to vary their interaction independently. It encapsulates object interaction in a mediator object, preventing direct communication between components.</p>
        </div>

        <div class="component-cards">
            <div class="component-card">
                <h3>Mediator</h3>
                <p>Defines an interface for communicating with Colleague objects</p>
            </div>
            <div class="component-card">
                <h3>Concrete Mediator</h3>
                <p>Implements the Mediator interface and coordinates Colleague objects</p>
            </div>
            <div class="component-card">
                <h3>Colleague</h3>
                <p>Communicates with other Colleagues through its Mediator</p>
            </div>
        </div>

        <h2>Live Demo: Smart Home Automation</h2>
        <p>A practical demonstration of the Mediator pattern using a smart home system where devices communicate through a central hub.</p>

        <div class="smart-home" id="smartHome"></div>
        
        <div class="event-log" id="eventLog">
            <div class="log-entry">System initialized. Waiting for device interactions...</div>
        </div>
    </div>

    <script>
        // Mediator Interface
        class HomeAutomationMediator {
            notify(sender, event) {}
        }

        // Concrete Mediator
        class SmartHomeHub extends HomeAutomationMediator {
            constructor() {
                super();
                this.devices = new Map();
            }

            registerDevice(device) {
                this.devices.set(device.id, device);
                this.logEvent(`Registered ${device.name}`);
            }

            notify(sender, event) {
                this.logEvent(`${sender.name} triggered event: ${event}`);

                switch(event) {
                    case 'MOTION_DETECTED':
                        if (this.getDevice('lights').isOff()) {
                            this.getDevice('lights').turnOn();
                        }
                        break;
                    case 'TEMPERATURE_HIGH':
                        this.getDevice('ac').turnOn();
                        break;
                    case 'TEMPERATURE_NORMAL':
                        this.getDevice('ac').turnOff();
                        break;
                    case 'SECURITY_BREACH':
                        this.getDevice('alarm').trigger();
                        this.getDevice('lights').flash();
                        break;
                }
            }

            getDevice(id) {
                return this.devices.get(id);
            }

            logEvent(message) {
                const log = document.getElementById('eventLog');
                const entry = document.createElement('div');
                entry.className = 'log-entry';
                entry.textContent = `${new Date().toLocaleTimeString()}: ${message}`;
                log.appendChild(entry);
                log.scrollTop = log.scrollHeight;
            }
        }

        // Base Colleague
        class SmartDevice {
            constructor(id, name, mediator) {
                this.id = id;
                this.name = name;
                this.mediator = mediator;
                this.state = 'off';
            }

            isOn() { return this.state === 'on'; }
            isOff() { return this.state === 'off'; }

            updateUI() {
                const deviceElement = document.getElementById(this.id);
                if (deviceElement) {
                    const statusElement = deviceElement.querySelector('.device-status');
                    statusElement.textContent = this.state.toUpperCase();
                    statusElement.className = `device-status status-${this.isOn() ? 'on' : 'off'}`;
                }
            }
        }

        // Concrete Colleagues
        class MotionSensor extends SmartDevice {
            constructor(mediator) {
                super('motion', 'Motion Sensor', mediator);
                this.mediator.registerDevice(this);
            }

            detect() {
                this.state = 'on';
                this.updateUI();
                this.mediator.notify(this, 'MOTION_DETECTED');
                setTimeout(() => {
                    this.state = 'off';
                    this.updateUI();
                }, 3000);
            }
        }

        class SmartLights extends SmartDevice {
            constructor(mediator) {
                super('lights', 'Smart Lights', mediator);
                this.mediator.registerDevice(this);
            }

            turnOn() {
                this.state = 'on';
                this.updateUI();
            }

            turnOff() {
                this.state = 'off';
                this.updateUI();
            }

            flash() {
                let count = 0;
                const flash = setInterval(() => {
                    this.state = this.isOn() ? 'off' : 'on';
                    this.updateUI();
                    count++;
                    if (count > 6) clearInterval(flash);
                }, 500);
            }
        }

        class Thermostat extends SmartDevice {
            constructor(mediator) {
                super('thermostat', 'Thermostat', mediator);
                this.temperature = 22;
                this.mediator.registerDevice(this);
            }

            setTemperature(temp) {
                this.temperature = temp;
                if (temp > 25) {
                    this.mediator.notify(this, 'TEMPERATURE_HIGH');
                } else if (temp < 24) {
                    this.mediator.notify(this, 'TEMPERATURE_NORMAL');
                }
                this.updateUI();
            }

            updateUI() {
                const deviceElement = document.getElementById(this.id);
                if (deviceElement) {
                    deviceElement.querySelector('.temperature').textContent = 
                        `${this.temperature}°C`;
                }
            }
        }

        class AirConditioner extends SmartDevice {
            constructor(mediator) {
                super('ac', 'Air Conditioner', mediator);
                this.mediator.registerDevice(this);
            }

            turnOn() {
                this.state = 'on';
                this.updateUI();
            }

            turnOff() {
                this.state = 'off';
                this.updateUI();
            }
        }

        class SecuritySystem extends SmartDevice {
            constructor(mediator) {
                super('security', 'Security System', mediator);
                this.mediator.registerDevice(this);
            }

            trigger() {
                this.state = 'on';
                this.updateUI();
                this.mediator.notify(this, 'SECURITY_BREACH');
                setTimeout(() => {
                    this.state = 'off';
                    this.updateUI();
                }, 5000);
            }
        }

        // UI Creation
        function createDeviceElement(device) {
            const deviceDiv = document.createElement('div');
            deviceDiv.className = 'device-card';
            deviceDiv.id = device.id;

            let controlsHtml = '';
            switch(device.constructor.name) {
                case 'MotionSensor':
                    controlsHtml = `
                        <button class="btn" onclick="motionSensor.detect()">
                            Simulate Motion
                        </button>
                    `;
                    break;
                case 'SmartLights':
                    controlsHtml = `
                        <button class="btn" onclick="smartLights.turnOn()">Turn On</button>
                        <button class="btn" onclick="smartLights.turnOff()">Turn Off</button>
                    `;
                    break;
                case 'Thermostat':
                    controlsHtml = `
                        <div class="temperature">${device.temperature}°C</div>
                        <button class="btn" onclick="thermostat.setTemperature(thermostat.temperature + 1)">
                            Increase Temp
                        </button>
                        <button class="btn" onclick="thermostat.setTemperature(thermostat.temperature - 1)">
                            Decrease Temp
                        </button>
                    `;
                    break;
                case 'SecuritySystem':
                    controlsHtml = `
                        <button class="btn" onclick="security.trigger()">
                            Trigger Alert
                        </button>
                    `;
                    break;
            }

            deviceDiv.innerHTML = `
                <div class="device-header">
                    <h3>${device.name}</h3>
                    <span class="device-status status-off">OFF</span>
                </div>
                <div class="device-controls">
                    ${controlsHtml}
                </div>
            `;

            return deviceDiv;
        }

        // Initialize System
        const hub = new SmartHomeHub();
        const motionSensor = new MotionSensor(hub);
        const smartLights = new SmartLights(hub);
        const thermostat = new Thermostat(hub);
        const ac = new AirConditioner(hub);
        const security = new SecuritySystem(hub);

        const smartHome = document.getElementById('smartHome');
        [motionSensor, smartLights, thermostat, security].forEach(device => {
            smartHome.appendChild(createDeviceElement(device));
        });
    </script>
</body>
</html>