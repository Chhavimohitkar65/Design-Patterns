<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>State Pattern - Traffic Light Demo</title>
    <style>
        :root {
            --red: #EF4444;
            --yellow: #F59E0B;
            --green: #10B981;
            --dark: #1F2937;
            --light: #F3F4F6;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, sans-serif;
        }

        body {
            background: var(--light);
            color: var(--dark);
            line-height: 1.6;
            padding: 2rem;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .pattern-header {
            background: var(--dark);
            color: white;
            padding: 2rem;
            border-radius: 1rem;
            margin-bottom: 2rem;
        }

        .pattern-header h1 {
            font-size: 2rem;
            margin-bottom: 1rem;
        }

        .pattern-definition {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .pattern-definition h2 {
            color: var(--dark);
            margin-bottom: 1rem;
        }

        .demo-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        .traffic-light {
            background: #333;
            width: 140px;
            padding: 20px;
            border-radius: 30px;
            margin: 2rem auto;
            box-shadow: 
                0 0 0 10px rgba(0, 0, 0, 0.1),
                inset 0 0 20px rgba(0, 0, 0, 0.5);
        }

        .light {
            width: 100px;
            height: 100px;
            background: #000;
            border-radius: 50%;
            margin: 10px auto;
            transition: all 0.3s ease;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.5);
        }

        .light.active {
            box-shadow: 
                0 0 20px rgba(255, 255, 255, 0.8),
                0 0 40px currentColor,
                inset 0 0 20px currentColor;
        }

        .light.red { color: var(--red); }
        .light.yellow { color: var(--yellow); }
        .light.green { color: var(--green); }

        .controls {
            text-align: center;
            margin: 2rem 0;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            background: var(--dark);
            color: white;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
            margin: 0 0.5rem;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .state-info {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .state-diagram {
            margin: 2rem 0;
            padding: 1rem;
            background: var(--light);
            border-radius: 0.5rem;
        }

        .state-log {
            max-height: 300px;
            overflow-y: auto;
        }

        .log-entry {
            padding: 1rem;
            border-bottom: 1px solid var(--light);
            display: flex;
            align-items: center;
            gap: 1rem;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(-20px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .code-example {
            background: var(--dark);
            color: white;
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
            font-family: monospace;
            white-space: pre;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="pattern-header">
            <h1>State Design Pattern</h1>
            <p>A behavioral design pattern that lets an object alter its behavior when its internal state changes.</p>
        </div>

        <div class="pattern-definition">
            <h2>Definition & Purpose</h2>
            <p>The State pattern allows an object to:</p>
            <ul style="margin-left: 2rem; margin-top: 1rem;">
                <li>Change its behavior when its internal state changes</li>
                <li>Appear as if it changed its class</li>
                <li>Keep state-specific behavior in separate classes</li>
                <li>Transition between states independently</li>
            </ul>
        </div>

        <div class="demo-container">
            <div class="demo-section">
                <div class="traffic-light">
                    <div class="light red"></div>
                    <div class="light yellow"></div>
                    <div class="light green"></div>
                </div>

                <div class="controls">
                    <button id="changeBtn" class="btn">Change State</button>
                    <button id="autoBtn" class="btn">Auto Mode</button>
                </div>
            </div>

            <div class="state-info">
                <h3>Current State Information</h3>
                <div id="stateLog" class="state-log"></div>
            </div>
        </div>
    </div>

    <script>
        // State interface
        class TrafficLightState {
            constructor(light) {
                this.light = light;
            }
            
            enter() {}
            exit() {}
            change() {}
            getStateName() {}
            getStateActions() {}
        }

        // Concrete States
        class RedLightState extends TrafficLightState {
            enter() {
                document.querySelector('.light.red').classList.add('active');
                this.logState('Stop! Red light is active');
            }

            exit() {
                document.querySelector('.light.red').classList.remove('active');
            }

            change() {
                return new GreenLightState(this.light);
            }

            getStateName() {
                return "Red Light";
            }

            getStateActions() {
                return "All vehicles must stop";
            }
        }

        class YellowLightState extends TrafficLightState {
            enter() {
                document.querySelector('.light.yellow').classList.add('active');
                this.logState('Caution! Yellow light is active');
            }

            exit() {
                document.querySelector('.light.yellow').classList.remove('active');
            }

            change() {
                return new RedLightState(this.light);
            }

            getStateName() {
                return "Yellow Light";
            }

            getStateActions() {
                return "Prepare to stop";
            }
        }

        class GreenLightState extends TrafficLightState {
            enter() {
                document.querySelector('.light.green').classList.add('active');
                this.logState('Go! Green light is active');
            }

            exit() {
                document.querySelector('.light.green').classList.remove('active');
            }

            change() {
                return new YellowLightState(this.light);
            }

            getStateName() {
                return "Green Light";
            }

            getStateActions() {
                return "Vehicles may proceed";
            }
        }

        // Add logging functionality to all states
        [RedLightState, YellowLightState, GreenLightState].forEach(state => {
            state.prototype.logState = function(message) {
                const log = document.getElementById('stateLog');
                const entry = document.createElement('div');
                entry.className = 'log-entry';
                
                const time = new Date().toLocaleTimeString();
                entry.innerHTML = `
                    <div>
                        <strong>${this.getStateName()}</strong>
                        <div>${this.getStateActions()}</div>
                        <small>${time}</small>
                    </div>
                `;

                log.insertBefore(entry, log.firstChild);

                if (log.children.length > 5) {
                    log.removeChild(log.lastChild);
                }
            };
        });

        // Context
        class TrafficLight {
            constructor() {
                this.state = new RedLightState(this);
                this.state.enter();
                this.autoMode = false;
                this.autoInterval = null;
            }

            setState(state) {
                this.state.exit();
                this.state = state;
                this.state.enter();
            }

            change() {
                this.setState(this.state.change());
            }

            toggleAutoMode() {
                this.autoMode = !this.autoMode;
                if (this.autoMode) {
                    this.autoInterval = setInterval(() => this.change(), 2000);
                    document.getElementById('autoBtn').textContent = 'Stop Auto';
                } else {
                    clearInterval(this.autoInterval);
                    document.getElementById('autoBtn').textContent = 'Auto Mode';
                }
            }
        }

        // Initialize the traffic light
        const trafficLight = new TrafficLight();

        // Add event listeners
        document.getElementById('changeBtn').addEventListener('click', () => trafficLight.change());
        document.getElementById('autoBtn').addEventListener('click', () => trafficLight.toggleAutoMode());
    </script>
</body>
</html>